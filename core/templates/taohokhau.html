{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="page-header">
    <h2 class="page-title">
        <span id="pageTitle">{% if is_edit %}Cập nhật hộ khẩu{% else %}Tạo hộ khẩu mới{% endif %}</span>
    </h2>
    <div class="header-actions">
        <a href="{% url 'sohokhau' %}" class="btn">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
        <button class="btn secondary" id="previewBtn" onclick="previewHousehold()">
            <i class="fas fa-eye"></i> Xem trước
        </button>
        <button class="btn primary" id="saveBtn" onclick="saveHousehold()">
            <i class="fas fa-save"></i> Lưu hộ khẩu
        </button>
    </div>
</div>

<!-- Progress Steps -->
<div class="progress-steps">
    <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">Thông tin cơ bản</div>
    </div>
    <div class="step" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">Địa chỉ thường trú</div>
    </div>
    <div class="step" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">Thông tin chủ hộ</div>
    </div>
    <div class="step" data-step="4">
        <div class="step-number">4</div>
        <div class="step-label">Hoàn tất</div>
    </div>
</div>

<!-- Main Form Container -->
<div class="form-container">
    <form id="householdForm" class="household-form">
        <!-- Step 1: Basic Information -->
        <div class="form-step active" id="step-1">
            <div class="step-header">
                <h3><i class="fas fa-info-circle"></i> Thông tin cơ bản</h3>
                <p>Nhập thông tin cơ bản về hộ khẩu</p>
            </div>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="householdCode">Mã hộ khẩu</label>
                        <input type="text" id="householdCode" class="form-input" 
                               placeholder="HK-XXX (Tự động tạo nếu để trống)">
                        <small class="form-help">Mã hộ khẩu sẽ được tự động tạo nếu bạn để trống</small>
                    </div>
                    <div class="form-group">
                        <label for="creationDate" class="required">Ngày lập sổ</label>
                        <input type="date" id="creationDate" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="creationReason" class="required">Lý do lập sổ</label>
                    <select id="creationReason" class="form-input" required>
                        <option value="">-- Chọn lý do lập sổ --</option>
                        <option value="new_household">Thành lập hộ mới</option>
                        <option value="split_household">Tách hộ từ hộ khác</option>
                        <option value="merge_household">Nhập hộ từ nơi khác</option>
                        <option value="relocation">Chuyển đến từ địa phương khác</option>
                        <option value="marriage">Kết hôn lập gia đình</option>
                        <option value="other">Lý do khác</option>
                    </select>
                </div>
                
                <div class="form-group" id="otherReasonGroup" style="display: none;">
                    <label for="otherReason">Ghi rõ lý do khác</label>
                    <textarea id="otherReason" class="form-input" rows="3" 
                              placeholder="Mô tả cụ thể lý do lập sổ hộ khẩu..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="previousHousehold">Hộ khẩu trước đây (nếu có)</label>
                    <input type="text" id="previousHousehold" class="form-input" 
                           placeholder="Mã hộ khẩu cũ hoặc địa chỉ nơi ở trước">
                    <small class="form-help">Chỉ áp dụng cho trường hợp tách hộ hoặc chuyển đến</small>
                </div>
            </div>
        </div>

        <!-- Step 2: Address Information -->
        <div class="form-step" id="step-2">
            <div class="step-header">
                <h3><i class="fas fa-map-marker-alt"></i> Địa chỉ thường trú</h3>
                <p>Nhập đầy đủ thông tin địa chỉ nơi ở thường xuyên</p>
            </div>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="houseNumber" class="required">Số nhà</label>
                        <input type="text" id="houseNumber" class="form-input" 
                               placeholder="Số 12, 34A, 56/78..." required>
                    </div>
                    <div class="form-group">
                        <label for="streetName" class="required">Tên đường/ngõ/phố</label>
                        <input type="text" id="streetName" class="form-input" 
                               placeholder="Đường Lạc Long Quân, Ngõ 123..." required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="wardName" class="required">Phường/Xã</label>
                        <select id="wardName" class="form-input" required>
                            <option value="">-- Chọn phường/xã --</option>
                            <option value="La Khê">Phường La Khê</option>
                            <option value="Phú La">Phường Phú La</option>
                            <option value="Phú Lương">Phường Phú Lương</option>
                            <option value="Phúc La">Phường Phúc La</option>
                            <option value="Kiến Hưng">Phường Kiến Hưng</option>
                            <option value="Hà Cầu">Phường Hà Cầu</option>
                            <option value="Yên Nghĩa">Phường Yên Nghĩa</option>
                            <option value="Biên Giang">Phường Biên Giang</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="districtName" class="required">Quận/Huyện</label>
                        <input type="text" id="districtName" class="form-input" 
                               value="Hà Đông" readonly>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="provinceName" class="required">Tỉnh/Thành phố</label>
                        <input type="text" id="provinceName" class="form-input" 
                               value="Hà Nội" readonly>
                    </div>
                    <div class="form-group">
                        <label for="postalCode">Mã bưu điện</label>
                        <input type="text" id="postalCode" class="form-input" 
                               placeholder="100000">
                    </div>
                </div>
                
                <div class="address-preview">
                    <h4>Địa chỉ đầy đủ:</h4>
                    <div id="fullAddress" class="address-display">
                        Chưa nhập đủ thông tin địa chỉ
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Head of Household Information -->
        <div class="form-step" id="step-3">
            <div class="step-header">
                <h3><i class="fas fa-user-tie"></i> Thông tin chủ hộ</h3>
                <p>Nhập thông tin cá nhân của chủ hộ gia đình</p>
            </div>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="headFullName" class="required">Họ và tên</label>
                        <input type="text" id="headFullName" class="form-input" 
                               placeholder="Nguyễn Văn An" required>
                    </div>
                    <div class="form-group">
                        <label for="headAlias">Tên thường gọi</label>
                        <input type="text" id="headAlias" class="form-input" 
                               placeholder="An, Anh An...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="headDob" class="required">Ngày sinh</label>
                        <input type="date" id="headDob" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="headGender" class="required">Giới tính</label>
                        <select id="headGender" class="form-input" required>
                            <option value="">-- Chọn giới tính --</option>
                            <option value="M">Nam</option>
                            <option value="F">Nữ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="headIdNumber" class="required">Số CMND/CCCD</label>
                        <input type="text" id="headIdNumber" class="form-input" 
                               placeholder="001234567890" required 
                               pattern="[0-9]{9,12}" maxlength="12">
                        <small class="form-help">Nhập 9-12 số của CMND hoặc CCCD</small>
                    </div>
                    <div class="form-group">
                        <label for="headIdIssueDate">Ngày cấp CMND/CCCD</label>
                        <input type="date" id="headIdIssueDate" class="form-input">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="headIdIssuePlace">Nơi cấp CMND/CCCD</label>
                    <input type="text" id="headIdIssuePlace" class="form-input" 
                           placeholder="Cục Cảnh sát ĐKQL cư trú và DLQG về dân cư">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="headOccupation">Nghề nghiệp</label>
                        <input type="text" id="headOccupation" class="form-input" 
                               placeholder="Kỹ sư, Giáo viên, Công nhân...">
                    </div>
                    <div class="form-group">
                        <label for="headWorkplace">Nơi làm việc</label>
                        <input type="text" id="headWorkplace" class="form-input" 
                               placeholder="Tên công ty, cơ quan...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="headEthnicity">Dân tộc</label>
                        <select id="headEthnicity" class="form-input">
                            <option value="Kinh" selected>Kinh</option>
                            <option value="Tày">Tày</option>
                            <option value="Thái">Thái</option>
                            <option value="Hoa">Hoa</option>
                            <option value="Khmer">Khmer</option>
                            <option value="Mường">Mường</option>
                            <option value="Nùng">Nùng</option>
                            <option value="Hmông">Hmông</option>
                            <option value="Dao">Dao</option>
                            <option value="Gia Rai">Gia Rai</option>
                            <option value="Ê Đê">Ê Đê</option>
                            <option value="Ba Na">Ba Na</option>
                            <option value="Sán Chay">Sán Chay</option>
                            <option value="Chăm">Chăm</option>
                            <option value="Sán Dìu">Sán Dìu</option>
                            <option value="Hrê">Hrê</option>
                            <option value="Ra Glai">Ra Glai</option>
                            <option value="Mnông">Mnông</option>
                            <option value="Thổ">Thổ</option>
                            <option value="Xtiêng">Xtiêng</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="headReligion">Tôn giáo</label>
                        <select id="headReligion" class="form-input">
                            <option value="">Không</option>
                            <option value="Phật giáo">Phật giáo</option>
                            <option value="Công giáo">Công giáo</option>
                            <option value="Tin Lành">Tin Lành</option>
                            <option value="Cao Đài">Cao Đài</option>
                            <option value="Hòa Hảo">Hòa Hảo</option>
                            <option value="Hồi giáo">Hồi giáo</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="headEducation">Trình độ học vấn</label>
                    <select id="headEducation" class="form-input">
                        <option value="">-- Chọn trình độ học vấn --</option>
                        <option value="Mầm non">Mầm non</option>
                        <option value="Tiểu học">Tiểu học</option>
                        <option value="Trung học cơ sở">Trung học cơ sở</option>
                        <option value="Trung học phổ thông">Trung học phổ thông</option>
                        <option value="Trung cấp">Trung cấp</option>
                        <option value="Cao đẳng">Cao đẳng</option>
                        <option value="Đại học">Đại học</option>
                        <option value="Thạc sĩ">Thạc sĩ</option>
                        <option value="Tiến sĩ">Tiến sĩ</option>
                        <option value="Khác">Khác</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Step 4: Summary and Additional Information -->
        <div class="form-step" id="step-4">
            <div class="step-header">
                <h3><i class="fas fa-check-circle"></i> Hoàn tất và xác nhận</h3>
                <p>Kiểm tra lại thông tin và thêm ghi chú nếu cần</p>
            </div>
            
            <div class="form-section">
                <!-- Summary Preview -->
                <div class="summary-preview">
                    <h4>Tóm tắt thông tin hộ khẩu</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <label>Mã hộ khẩu:</label>
                            <span id="summaryCode">-</span>
                        </div>
                        <div class="summary-item">
                            <label>Chủ hộ:</label>
                            <span id="summaryHeadName">-</span>
                        </div>
                        <div class="summary-item">
                            <label>Ngày lập:</label>
                            <span id="summaryDate">-</span>
                        </div>
                        <div class="summary-item">
                            <label>Địa chỉ:</label>
                            <span id="summaryAddress">-</span>
                        </div>
                        <div class="summary-item">
                            <label>CMND/CCCD:</label>
                            <span id="summaryIdNumber">-</span>
                        </div>
                        <div class="summary-item">
                            <label>Nghề nghiệp:</label>
                            <span id="summaryOccupation">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="householdNotes">Ghi chú bổ sung</label>
                    <textarea id="householdNotes" class="form-input" rows="4" 
                              placeholder="Ghi chú thêm về hộ khẩu này (tùy chọn)..."></textarea>
                </div>
                
                <div class="confirmation-section">
                    <div class="confirmation-box">
                        <h5><i class="fas fa-exclamation-triangle"></i> Xác nhận thông tin</h5>
                        <p>Vui lòng kiểm tra kỹ tất cả thông tin trước khi lưu. Sau khi tạo sổ hộ khẩu, 
                           việc chỉnh sửa một số thông tin cơ bản sẽ cần qua quy trình phê duyệt.</p>
                        <label class="checkbox-confirm">
                            <input type="checkbox" id="confirmInformation" required>
                            <span>Tôi xác nhận rằng tất cả thông tin đã nhập là chính xác và đúng sự thật</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Navigation -->
        <div class="form-navigation">
            <button type="button" class="btn nav-btn" id="prevBtn" onclick="previousStep()">
                <i class="fas fa-chevron-left"></i> Bước trước
            </button>
            <button type="button" class="btn nav-btn primary" id="nextBtn" onclick="nextStep()">
                Bước tiếp <i class="fas fa-chevron-right"></i>
            </button>
            <button type="submit" class="btn nav-btn primary" id="submitBtn" style="display: none;" onclick="submitForm()">
                <i class="fas fa-save"></i> Lưu hộ khẩu
            </button>
        </div>
    </form>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="modal" style="display: none;">
    <div class="modal-content preview-modal">
        <div class="modal-header">
            <h3><i class="fas fa-eye"></i> Xem trước thông tin hộ khẩu</h3>
            <span class="close" onclick="closePreviewModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="preview-content" id="previewContent">
                <!-- Preview content will be generated here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closePreviewModal()">Đóng</button>
            <button class="btn primary" onclick="closePreviewModal(); submitForm()">Xác nhận và lưu</button>
        </div>
    </div>
</div>

<!-- Success Message -->
<div id="successMessage" class="success-message" style="display: none;">
    <div class="success-content">
        <i class="fas fa-check-circle"></i>
        <h3>Tạo hộ khẩu thành công!</h3>
        <p>Sổ hộ khẩu đã được tạo và lưu vào hệ thống.</p>
        <div class="success-actions">
            <button class="btn" onclick="createAnother()">Tạo hộ khẩu khác</button>
            <button class="btn primary" onclick="viewHousehold()">Xem hộ khẩu vừa tạo</button>
        </div>
    </div>
</div>

<script src="{% static 'js/taohokhau.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/taohokhau.css' %}">
{% endblock %}
