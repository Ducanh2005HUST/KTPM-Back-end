{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="page-header">
    <h2 class="page-title">Quản lý Nhân khẩu</h2>
    <div class="header-actions">
        <a href="{% url 'themnk' %}" class="btn primary" id="addPersonBtn">
            <i class="fas fa-user-plus"></i> Thêm nhân khẩu
        </a>
        <button class="btn" id="advancedSearchBtn">
            <i class="fas fa-filter"></i> Tìm kiếm nâng cao
        </button>
        <button class="btn" id="exportBtn">
            <i class="fas fa-file-export"></i> Xuất danh sách
        </button>
    </div>
</div>

<!-- Search Panel -->
<div class="search-panel">
    <div class="search-block">
        <label for="searchPerson">
            <i class="fas fa-user"></i>
            Tìm kiếm nhân khẩu
        </label>
        <div class="search-input-wrapper">
            <i class="fas fa-search"></i>
            <input id="searchPerson" class="search-input" 
                   placeholder="Nhập họ tên, CMND/CCCD, ngày sinh hoặc mã hộ khẩu">
        </div>
    </div>

    <div class="search-block" id="advancedSearch" style="display: none;">
        <h3>Tìm kiếm nâng cao</h3>
        <div class="filter-row">
            <label>Họ và tên
                <input type="text" id="filterFullName" placeholder="Nguyễn Văn A">
            </label>
            <label>CMND/CCCD
                <input type="text" id="filterIdNumber" placeholder="012345678">
            </label>
            <label>Mã hộ khẩu
                <input type="text" id="filterHouseholdCode" placeholder="HK-001">
            </label>
        </div>
        <div class="filter-row">
            <label>Giới tính
                <select id="filterGender">
                    <option value="">-- Tất cả --</option>
                    <option value="M">Nam</option>
                    <option value="F">Nữ</option>
                    <option value="O">Khác</option>
                </select>
            </label>
            <label>Tuổi từ
                <input type="number" id="filterAgeFrom" placeholder="18" min="0" max="120">
            </label>
            <label>Tuổi đến
                <input type="number" id="filterAgeTo" placeholder="65" min="0" max="120">
            </label>
        </div>
        <div class="actions">
            <button class="btn primary" id="applyFilters">Áp dụng</button>
            <button class="btn" id="clearFilters">Xóa bộ lọc</button>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="stats-grid" style="grid-template-columns: repeat(5, 1fr); margin-bottom: 20px;">
    <div class="stat-card blue">
        <i class="fas fa-users icon"></i>
        <span class="number" id="totalPersons">0</span>
        <span class="label">Tổng nhân khẩu</span>
    </div>
    <div class="stat-card green">
        <i class="fas fa-male icon"></i>
        <span class="number" id="maleCount">0</span>
        <span class="label">Nam</span>
    </div>
    <div class="stat-card yellow">
        <i class="fas fa-female icon"></i>
        <span class="number" id="femaleCount">0</span>
        <span class="label">Nữ</span>
    </div>
    <div class="stat-card purple">
        <i class="fas fa-child icon"></i>
        <span class="number" id="childrenCount">0</span>
        <span class="label">Trẻ em (< 18)</span>
    </div>
    <div class="stat-card blue">
        <i class="fas fa-user-tie icon"></i>
        <span class="number" id="adultCount">0</span>
        <span class="label">Người lớn</span>
    </div>
</div>

<!-- Main Content Panels -->
<div class="dashboard-panels">
    <!-- Person List Panel -->
    <div class="panel" style="grid-column: 1 / -1;">
        <div class="panel-header">
            <h3><i class="fas fa-list"></i> Danh sách nhân khẩu</h3>
            <span class="badge" id="personCount">0</span>
        </div>
        <div class="panel-body">
            <div class="table-container">
                <table class="table-basic">
                    <thead>
                        <tr>
                            <th>Họ và tên</th>
                            <th>Ngày sinh</th>
                            <th>Giới tính</th>
                            <th>CMND/CCCD</th>
                            <th>Hộ khẩu</th>
                            <th>Quan hệ</th>
                            <th>Nghề nghiệp</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="personList">
                        <!-- Sample data - sẽ được thay thế bằng dữ liệu thực -->
                        <tr>
                            <td><strong>Nguyễn Văn A</strong></td>
                            <td>15/03/1985</td>
                            <td>Nam</td>
                            <td>012345678</td>
                            <td>HK-001</td>
                            <td>Chủ hộ</td>
                            <td>Kỹ sư</td>
                            <td>
                                <button class="btn-sm" onclick="viewPerson(1)">
                                    <i class="fas fa-eye"></i> Xem
                                </button>
                                <button class="btn-sm" onclick="editPerson(1)">
                                    <i class="fas fa-edit"></i> Sửa
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Trần Thị B</strong></td>
                            <td>22/08/1990</td>
                            <td>Nữ</td>
                            <td>098765432</td>
                            <td>HK-002</td>
                            <td>Chủ hộ</td>
                            <td>Giáo viên</td>
                            <td>
                                <button class="btn-sm" onclick="viewPerson(2)">
                                    <i class="fas fa-eye"></i> Xem
                                </button>
                                <button class="btn-sm" onclick="editPerson(2)">
                                    <i class="fas fa-edit"></i> Sửa
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Lê Văn C</strong></td>
                            <td>10/12/2010</td>
                            <td>Nam</td>
                            <td>-</td>
                            <td>HK-001</td>
                            <td>Con</td>
                            <td>Học sinh</td>
                            <td>
                                <button class="btn-sm" onclick="viewPerson(3)">
                                    <i class="fas fa-eye"></i> Xem
                                </button>
                                <button class="btn-sm" onclick="editPerson(3)">
                                    <i class="fas fa-edit"></i> Sửa
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container" style="margin-top: 16px; display: flex; justify-content: center; gap: 8px;">
                <button class="btn-sm" id="prevPage" onclick="changePage(-1)">
                    <i class="fas fa-chevron-left"></i> Trước
                </button>
                <span id="pageInfo" style="padding: 8px 12px;">Trang 1 / 1</span>
                <button class="btn-sm" id="nextPage" onclick="changePage(1)">
                    Sau <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Adding/Editing Person -->
<div id="personModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Thêm nhân khẩu mới</h3>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="personForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Chọn hộ khẩu *</label>
                        <select id="personHousehold" class="form-input" required>
                            <option value="">-- Chọn hộ khẩu --</option>
                            <option value="HK-001">HK-001 - Nguyễn Văn A</option>
                            <option value="HK-002">HK-002 - Trần Thị B</option>
                            <option value="HK-003">HK-003 - Lê Văn C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-inline">
                            <input type="checkbox" id="personIsHead"> Là chủ hộ
                        </label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Họ và tên *</label>
                        <input type="text" id="personFullName" class="form-input" 
                               placeholder="Họ và tên đầy đủ" required>
                    </div>
                    <div class="form-group">
                        <label>Tên thường gọi</label>
                        <input type="text" id="personAlias" class="form-input" 
                               placeholder="Tên thường gọi">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ngày sinh *</label>
                        <input type="date" id="personDob" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>Giới tính *</label>
                        <select id="personGender" class="form-input" required>
                            <option value="">-- Chọn --</option>
                            <option value="M">Nam</option>
                            <option value="F">Nữ</option>
                            <option value="O">Khác</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Quan hệ với chủ hộ</label>
                        <select id="personRelation" class="form-input">
                            <option value="">-- Chọn quan hệ --</option>
                            <option value="Chủ hộ">Chủ hộ</option>
                            <option value="Vợ/Chồng">Vợ/Chồng</option>
                            <option value="Con">Con</option>
                            <option value="Cha/Mẹ">Cha/Mẹ</option>
                            <option value="Anh/Chị/Em">Anh/Chị/Em</option>
                            <option value="Ông/Bà">Ông/Bà</option>
                            <option value="Cháu">Cháu</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Số CMND/CCCD</label>
                        <input type="text" id="personIdNumber" class="form-input" 
                               placeholder="Số căn cước công dân">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Nghề nghiệp</label>
                    <input type="text" id="personOccupation" class="form-input" 
                           placeholder="Nghề nghiệp hiện tại">
                </div>
                
                <div class="form-group">
                    <label>Ghi chú</label>
                    <textarea id="personNotes" class="form-input" rows="3" 
                              placeholder="Thông tin bổ sung"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeModal()">Hủy</button>
            <button class="btn primary" onclick="savePerson()">Lưu</button>
        </div>
    </div>
</div>

<!-- Modal for Viewing Person Details -->
<div id="viewPersonModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Thông tin nhân khẩu</h3>
            <span class="close" onclick="closeViewModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="person-details">
                <div class="detail-section">
                    <h4><i class="fas fa-user"></i> Thông tin cá nhân</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Họ và tên:</label>
                            <span id="viewFullName">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Tên thường gọi:</label>
                            <span id="viewAlias">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Ngày sinh:</label>
                            <span id="viewDob">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Tuổi:</label>
                            <span id="viewAge">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Giới tính:</label>
                            <span id="viewGender">-</span>
                        </div>
                        <div class="detail-item">
                            <label>CMND/CCCD:</label>
                            <span id="viewIdNumber">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4><i class="fas fa-home"></i> Thông tin hộ khẩu</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Mã hộ khẩu:</label>
                            <span id="viewHouseholdCode">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Quan hệ với chủ hộ:</label>
                            <span id="viewRelation">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Địa chỉ:</label>
                            <span id="viewAddress">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h4><i class="fas fa-briefcase"></i> Thông tin nghề nghiệp</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>Nghề nghiệp:</label>
                            <span id="viewOccupation">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeViewModal()">Đóng</button>
            <button class="btn primary" onclick="editFromView()">Chỉnh sửa</button>
        </div>
    </div>
</div>

<!-- External JS -->
<script src="{% static 'js/nhankhau.js' %}"></script>
{% endblock %}