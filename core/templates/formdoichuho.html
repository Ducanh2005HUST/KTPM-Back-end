{% extends 'base.html' %}
{% load static %}

{% block title %}Đổi chủ hộ - LaKhê Connect{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/formdoichuho.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumb">
        <a href="{% url 'sohokhau' %}">Sổ hộ khẩu</a>
        <span class="separator">></span>
        <span class="current">Đổi chủ hộ</span>
    </div>
    <h2 class="page-title">
        <i class="fas fa-crown"></i>
        Đổi chủ hộ
    </h2>
</div>

<!-- Main Form Container -->
<div class="form-container">
    <form id="changeHeadForm" class="change-head-form">
        {% csrf_token %}
        
        <!-- Step 1: Household Selection -->
        <div class="form-step" data-step="1">
            <div class="step-header">
                <div class="step-number">1</div>
                <div class="step-info">
                    <h3><i class="fas fa-home"></i> Chọn hộ khẩu</h3>
                    <p>Chọn hộ khẩu cần thay đổi chủ hộ</p>
                </div>
            </div>
            <div class="step-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="householdCode">
                            Mã hộ khẩu <span class="required">*</span>
                        </label>
                        <select id="householdCode" name="householdCode" required>
                            <option value="">-- Chọn hộ khẩu --</option>
                        </select>
                    </div>
                </div>
                <div id="householdInfo" class="info-panel" style="display: none;">
                    <div class="info-header">
                        <i class="fas fa-info-circle"></i>
                        <span>Thông tin hộ khẩu</span>
                    </div>
                    <div class="info-content" id="householdDetails">
                        <!-- Household details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Current Head Info -->
        <div class="form-step" data-step="2">
            <div class="step-header">
                <div class="step-number">2</div>
                <div class="step-info">
                    <h3><i class="fas fa-user"></i> Chủ hộ hiện tại</h3>
                    <p>Thông tin chủ hộ hiện tại</p>
                </div>
            </div>
            <div class="step-content">
                <div id="currentHeadInfo" class="info-panel" style="display: none;">
                    <div class="info-header">
                        <i class="fas fa-user-tie"></i>
                        <span>Chủ hộ hiện tại</span>
                    </div>
                    <div class="info-content" id="currentHeadDetails">
                        <!-- Current head details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: New Head Selection -->
        <div class="form-step" data-step="3">
            <div class="step-header">
                <div class="step-number">3</div>
                <div class="step-info">
                    <h3><i class="fas fa-crown"></i> Chọn chủ hộ mới</h3>
                    <p>Chọn thành viên làm chủ hộ mới</p>
                </div>
            </div>
            <div class="step-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="newHeadId">
                            Thành viên mới <span class="required">*</span>
                        </label>
                        <select id="newHeadId" name="newHeadId" required>
                            <option value="">-- Chọn thành viên --</option>
                        </select>
                    </div>
                </div>
                <div id="newHeadInfo" class="info-panel" style="display: none;">
                    <div class="info-header">
                        <i class="fas fa-user-plus"></i>
                        <span>Chủ hộ mới</span>
                    </div>
                    <div class="info-content" id="newHeadDetails">
                        <!-- New head details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Change Details -->
        <div class="form-step" data-step="4">
            <div class="step-header">
                <div class="step-number">4</div>
                <div class="step-info">
                    <h3><i class="fas fa-edit"></i> Chi tiết thay đổi</h3>
                    <p>Thông tin về việc thay đổi chủ hộ</p>
                </div>
            </div>
            <div class="step-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="changeDate">
                            Ngày thay đổi <span class="required">*</span>
                        </label>
                        <input type="date" id="changeDate" name="changeDate" required>
                    </div>
                    <div class="form-group">
                        <label for="changeReason">
                            Lý do thay đổi <span class="required">*</span>
                        </label>
                        <select id="changeReason" name="changeReason" required>
                            <option value="">-- Chọn lý do --</option>
                            <option value="death">Chủ hộ cũ đã mất</option>
                            <option value="move_out">Chủ hộ cũ chuyển đi</option>
                            <option value="voluntary">Tự nguyện thay đổi</option>
                            <option value="incapable">Không đủ điều kiện</option>
                            <option value="other">Lý do khác</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="performedBy">
                            Người thực hiện <span class="required">*</span>
                        </label>
                        <input type="text" id="performedBy" name="performedBy" 
                               placeholder="Họ tên người làm thủ tục" required>
                    </div>
                    <div class="form-group">
                        <label for="approvalDocument">
                            Số giấy phép/Quyết định
                        </label>
                        <input type="text" id="approvalDocument" name="approvalDocument" 
                               placeholder="Số giấy phép (nếu có)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="notes">
                            Ghi chú
                        </label>
                        <textarea id="notes" name="notes" rows="3" 
                                  placeholder="Ghi chú thêm về việc đổi chủ hộ..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Confirmation -->
        <div class="form-step" data-step="5">
            <div class="step-header">
                <div class="step-number">5</div>
                <div class="step-info">
                    <h3><i class="fas fa-check-circle"></i> Xác nhận</h3>
                    <p>Xác nhận thông tin và hoàn tất</p>
                </div>
            </div>
            <div class="step-content">
                <div class="confirmation-panel">
                    <div class="confirmation-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Vui lòng kiểm tra kỹ các thông tin sau:</span>
                    </div>
                    <div class="checklist">
                        <div class="checklist-item">
                            <i class="fas fa-check"></i>
                            <span>Thông tin hộ khẩu và địa chỉ chính xác</span>
                        </div>
                        <div class="checklist-item">
                            <i class="fas fa-check"></i>
                            <span>Thông tin chủ hộ hiện tại đã được xác minh</span>
                        </div>
                        <div class="checklist-item">
                            <i class="fas fa-check"></i>
                            <span>Thành viên mới đủ điều kiện làm chủ hộ (≥18 tuổi)</span>
                        </div>
                        <div class="checklist-item">
                            <i class="fas fa-check"></i>
                            <span>Các giấy tờ liên quan đã được chuẩn bị</span>
                        </div>
                        <div class="checklist-item">
                            <i class="fas fa-check"></i>
                            <span>Lý do và ngày thay đổi hợp lý</span>
                        </div>
                    </div>
                    <div class="final-confirmation">
                        <label class="checkbox-container">
                            <input type="checkbox" id="finalConfirmation" name="finalConfirmation" required>
                            <span class="checkmark"></span>
                            <span class="label-text">
                                <strong>Tôi xác nhận đã kiểm tra kỹ thông tin và đồng ý thực hiện thay đổi chủ hộ</strong>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
            <!-- <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'sohokhau' %}'">
                <i class="fas fa-arrow-left"></i>
                Quay lại
            </button> -->
            <button type="button" class="btn btn-outline" id="previewBtn">
                <i class="fas fa-eye"></i>
                Xem trước
            </button>
            <button type="button" class="btn btn-warning" id="resetBtn">
                <i class="fas fa-undo"></i>
                Reset form
            </button>
            <button type="submit" class="btn btn-primary" id="submitBtn">
                <i class="fas fa-save"></i>
                Lưu thay đổi
            </button>
        </div>
    </form>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h4><i class="fas fa-eye"></i> Xem trước thông tin thay đổi</h4>
            <button type="button" class="close-btn" onclick="closePreviewModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="previewContent">
            <!-- Preview content will be loaded here -->
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closePreviewModal()">
                Đóng
            </button>
            <button type="button" class="btn btn-primary" onclick="confirmAndSubmit()">
                Xác nhận và lưu
            </button>
        </div>
    </div>
</div>

<!-- Success/Error Messages -->
<div id="messageContainer" class="message-container"></div>

<script src="{% static 'js/formdoichuho.js' %}"></script>
{% endblock %}